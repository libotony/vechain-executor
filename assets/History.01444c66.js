import{E as r,a as D,b as M,c as b,d as S,e as E,_ as x,i as H,h as N,f as l,o as T,p as L,q as O,B as j}from"./index.03e14050.js";import{d as R,i as F,r as y,n as G,B,a as $}from"./index.0d60b973.js";import{d as q}from"./index.9f4f781f.js";const z=R({__name:"History",setup(k){const e=F("$thor");let t=e.status.head.number;const s={Proposal:e.account(r.address).event(r.events.Proposal).filter([]).cache([r.address]),proposals:new D.Function(r.methods.proposals)},a=y([]),p=y(!1),f=y(!0);let m=Math.floor(new Date().getTime()/1e3);const P=i=>m-i<7*24*60*60,I=async()=>(t=e.status.head.number,a.value=[],f.value=!0,d=0,m=Math.floor(new Date().getTime()/1e3),h());let d=0;const _=10,h=async()=>{p.value=!0;let i=d;const C=100;let w=!1;t===0&&(e.status.head.number||await e.ticker().next(),t=e.status.head.number);const o=[];for(;;){const c=await s.Proposal.order("desc").range({unit:"block",from:0,to:t}).apply(i,C);if(!c.length)break;for(const[g,n]of c.entries()){const v=n.decoded.proposalID;n.decoded.action===r.actions.proposed&&(o.push(v),o.length>=_&&(d=i+g+1,w=!0))}if(w)break;i+=C}if(o.length){const c=[];for(let n=0;n<o.length;n++)c.push({to:r.address,value:0,data:s.proposals.encode(o[n])});const g=await e.explain(c).cache([r.address]).execute();for(const[n,v]of g.entries()){const u=s.proposals.decode(v.data);a.value.push({id:o[n],time:parseInt(u.timeProposed),desc:q(u.target,u.data),executed:u.executed})}}o.length<_&&(f.value=!1),p.value=!1};return h().catch(),{__sfc:!0,thor:e,head:t,executor:s,proposals:a,loading:p,hasMore:f,ts:m,isPending:P,refresh:I,pos:d,pageCount:_,loadData:h}}});var A=function(){var e=this,t=e._self._c,s=e._self._setupProxy;return t(B,{staticClass:"w-75 mx-auto"},[t(B,{staticClass:"mt-4"},[t(M,{attrs:{"no-body":""},scopedSlots:e._u([{key:"header",fn:function(){return[t("div",{staticClass:"d-flex justify-content-between"},[t("h4",{staticClass:"my-auto"},[e._v("History")]),t("span",[t(b,{attrs:{variant:"primary",pill:""},on:{click:s.refresh}},[t(S)],1)],1)])]},proxy:!0}])},[t(E,{attrs:{flush:""}},[t(x,{directives:[{name:"show",rawName:"v-show",value:s.proposals.length===0&&!s.loading,expression:"proposals.length===0 && !loading"}],scopedSlots:e._u([{key:"content",fn:function(){return[t("span",[e._v("NO CONTENT")])]},proxy:!0}])}),t(H,{directives:[{name:"show",rawName:"v-show",value:s.proposals.length!==0&&!s.loading,expression:"proposals.length!==0 && !loading"}]},[t(N,{staticClass:"my-1 font-weight-bold"},[t(l,{staticClass:"d-flex align-items-center",attrs:{lg:"3"}},[t("span",[e._v(" Time ")])]),t(l,{staticClass:"d-flex align-items-center",attrs:{lg:"7"}},[t("span",{staticClass:"text-monospace text-truncate"},[e._v(" Proposal ")])]),t(l,{staticClass:"d-flex align-items-center justify-content-end",attrs:{lg:"2"}},[t("span",[e._v(" Executed ")])])],1)],1),e._l(s.proposals,function(a){return t(x,{key:a.id,scopedSlots:e._u([{key:"content",fn:function(){return[t(l,{staticClass:"d-flex align-items-center",attrs:{lg:"3"}},[t("span",{staticClass:"text-smaller"},[e._v(" "+e._s(new Date(a.time*1e3).toLocaleString())+" ")])]),t(l,{staticClass:"d-flex align-items-center",attrs:{lg:"8"}},[t("span",{staticClass:"text-monospace text-truncate"},[t($,{attrs:{to:{name:"proposal",params:{id:a.id}}}},[e._v(e._s(a.desc))])],1)]),t(l,{staticClass:"d-flex align-items-center",attrs:{lg:"1"}},[a.executed?t(T,{attrs:{variant:"success"}}):s.isPending(a.time)?t(L):t(O,{attrs:{variant:"danger"}})],1)]},proxy:!0}],null,!0)})}),t(x,{scopedSlots:e._u([{key:"content",fn:function(){return[t(j,{staticClass:"d-inline-block",attrs:{show:s.loading,rounded:"",opacity:"0.6","spinner-small":"","spinner-variant":"primary"}},[t(b,{ref:"button",attrs:{disabled:s.loading||!s.hasMore,variant:"primary"},on:{click:s.loadData}},[e._v(" MORE ")])],1)]},proxy:!0}])})],2)],1)],1)],1)},X=[],J=G(z,A,X,!1,null,null,null,null);const V=J.exports;export{V as default};
